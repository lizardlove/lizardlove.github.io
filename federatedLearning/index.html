<!DOCTYPE html><html class="theme-next pisces" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#fff"><link rel="preload" href="/fonts/sigmarone3.woff2" as="font" type="font/woff2" crossorigin="anonymous"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css?v=0.0.53" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=0.0.53"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico?v=0.0.53"><link rel="mask-icon" href="/safari-pinned-tab.svg?v=0.0.53" color="#fff"><link rel="manifest" href="/manifest.json"><meta name="keywords" content="Pipiper,blog"><link rel="alternate" href="/atom.xml" title="Pipiper coming !" type="application/atom+xml"><meta name="description" content="随手笔记，针对目前现有的几个大型应用案例的分析。"><meta property="og:type" content="article"><meta property="og:title" content="联邦学习笔记"><meta property="og:url" content="http://blog.lizardlove.ren/federatedLearning/index.html"><meta property="og:site_name" content="Pipiper coming !"><meta property="og:description" content="随手笔记，针对目前现有的几个大型应用案例的分析。"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://blog.lizardlove.ren/images/compute_graph.jpg"><meta property="og:image" content="http://blog.lizardlove.ren/images/bias1.jpg"><meta property="og:image" content="http://blog.lizardlove.ren/images/bias2.jpg"><meta property="og:image" content="http://blog.lizardlove.ren/images/RProp.jpg"><meta property="og:image" content="http://blog.lizardlove.ren/images/lr.jpg"><meta property="og:image" content="http://blog.lizardlove.ren/Users/pipiper/Project/blog/source/images/Gborad_result.jpg"><meta property="og:image" content="http://blog.lizardlove.ren/images/FederatedAveraging.jpg"><meta property="article:published_time" content="2019-09-07T16:00:00.000Z"><meta property="article:modified_time" content="2020-01-06T10:38:54.285Z"><meta property="article:author" content="Pipiper"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://blog.lizardlove.ren/images/compute_graph.jpg"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"0.0.53",sidebar:{position:"right",display:"always",offset:52,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!1,tabs:!0,motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},since:"1/1/2017 11:30:00",onlineAPI:"",site:{title:"Pipiper coming !",subtitle:"",author:"Pipiper"},duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},leancloud:{enable:!1,appID:"Ti5mwFDXXbpWqeWdaydLNfOS-gzGzoHsz",appKey:"rXpryRyVs5jlk2LAGGI1bfEd"},favicon:{visibilitychange:!0,narmal:"/favicon.ico",hidden:"/failure.ico",show_text:"(/≧▽≦/)咦！又好了！",hide_text:"(●—●)喔哟，崩溃啦！"}}</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/disqusjs@1.2.2/dist/disqus.js"></script><link rel="canonical" href="http://blog.lizardlove.ren/federatedLearning/"><title>联邦学习笔记 | Pipiper coming !</title><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-155379950-1","auto"),ga("send","pageview")</script><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage" lang="en" class="theme-darling"><div class="container sidebar-position-right page-post-detail"><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-抓到我"><a href="javascript:;" rel="section"><i class="menu-item-icon fa fa-fw fa-sign-language"></i><br>抓到我</a><ul class="submenu submenu-抓到我"><li class="submenu-item submenu-item-github"><a href="https://github.com/lizardlove" rel="section" target="_blank">GitHub</a></li><li class="submenu-item submenu-item-twitter"><a href="https://twitter.com/xiyiailoli" rel="section" target="_blank">Twitter</a></li><li class="submenu-item submenu-item-gmail"><a href="mailto:xiyiailoli@gmail.com" rel="section" target="_blank">Gmail</a></li><li class="submenu-item submenu-item-telegram"><a href="https://t.me/PipiperZhang" rel="section" target="_blank">Telegram</a></li></ul></li><li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-留言板"><a href="/message/" rel="section"><i class="menu-item-icon fa fa-fw fa-pencil"></i><br>留言板</a></li><li class="menu-item search"><form class="search-form"><input name="keyword" type="text" class="search-input" placeholder="站内搜索"> <button type="submit" class="search-submit"><i class="fa fa-search"></i></button></form></li></ul></nav><div class="site-brand-wrapper" style="background-image:url(/images/header.jpg)"><div class="site-meta"><div class="custom-logo-site-title"><div class="brand"><span class="logo-line-before"><i></i></span><div class="site-title"><div id="animate" class="animate"><span>P</span><span>i</span><span>p</span><span>i</span><span>p</span><span>e</span><span>r</span><span> </span><span>c</span><span>o</span><span>m</span><span>i</span><span>n</span><span>g</span><span> </span><span>!</span></div><div id="guide" class="guide"><span>P</span><span>i</span><span>p</span><span>i</span><span>p</span><span>e</span><span>r</span><span> </span><span>c</span><span>o</span><span>m</span><span>i</span><span>n</span><span>g</span><span> </span><span>!</span></div></div><span class="logo-line-after"><i></i></span></div></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><div class="site-master" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-master-avatar" itemprop="image" src="/images/Pipiper.jpg" alt="Pipiper"><h2 class="site-master-description" itemprop="description"><span>Life is a single player game.</span></h2></div></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-date"><div class="post-month">09月</div><div class="post-day">08</div></div><div class="post-badge"><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a></span></div><div class="post-block"><link itemprop="mainEntityOfPage" href="http://blog.lizardlove.ren/federatedLearning/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Pipiper"><meta itemprop="description" content=""><meta itemprop="image" content="/images/Pipiper.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Pipiper coming !"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">联邦学习笔记</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-08T00:00:00+08:00">2019-09-08</time> </span><span class="post-wordcount"><span class="post-meta-divider">•</span> <span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">Words count in article</span> <span title="Words count in article">4790</span></span></div></header><div class="post-body" itemprop="articleBody"><p>随手笔记，针对目前现有的几个大型应用案例的分析。</p><a id="more"></a><h3 id="WeBank联邦学习应用与研究"><a href="#WeBank联邦学习应用与研究" class="headerlink" title="WeBank联邦学习应用与研究"></a><a href="https://arxiv.org/pdf/1902.04885.pdf" target="_blank" rel="noopener">WeBank联邦学习应用与研究</a></h3><h4 id="原因："><a href="#原因：" class="headerlink" title="原因："></a>原因：</h4><p>各种隐私保护法规导致数据孤岛愈发严重，联邦学习致力于解决数据孤岛问题 [14-15] <strong>数据安全，信息孤岛</strong></p><h4 id="概述："><a href="#概述：" class="headerlink" title="概述："></a>概述：</h4><ul><li>各方<strong>数据保留在本地</strong>，不泄露隐私也不违反法规</li><li>多个参与者联合数据建立<strong>虚拟的共有模型</strong>，并且共同获益的体系</li><li>在联邦学习的体系下，各个<strong>参与者的身份和地位相同</strong></li><li>保证数据的用户对齐或特征对齐，联邦学习的建模效果和将整个数据集放在一处建模的效果相同</li><li>数据的用户或特征不对齐时，迁移学习也可以在数据间通过交换加密参数达到知识迁移的效果</li></ul><h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p>按两个数据中心的用户数据重叠程度划分</p><p>数据集D(用户$X_i$，用户特征$X_i^t$)</p><ul><li><p>横向联邦学习</p><blockquote><p>用户特征$X^t$重叠较大，而用户$X$重叠较小</p></blockquote><p>数据集按横向用户纬度$X_i$ 进行划分，使用双方用户特征相同而用户不完全相同的数据进行训练</p><p>=&gt; 扩展数据集</p></li><li><p>纵向联邦学习</p><blockquote><p>用户$X$重叠较大，用户特征重$X^t$叠较小</p></blockquote><p>数据集按纵向用户特征纬度$X_i^t$ 进行划分，使用双方用户相同而用户特征不完全相同的部分数据进行训练</p><p>=&gt; 扩展用户特征信息</p></li><li><p>联邦迁移学习</p><blockquote><p>用户$X$和用户特征$X^t$重叠均较小</p></blockquote><p>使用迁移学习进行训练</p></li></ul><p><em>三种学习方式由于数据划分方式的不同，应该是面向不同场景的模型，但实际场景中，三种场景可能相互交叉，如何相互兼容？</em></p><h4 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h4><blockquote><p>纵向联邦学习，两个数据中心A,B</p></blockquote><ol><li><p>用户样本加密对齐：筛选出A,B共有用户</p></li><li><p>加密模型训练：引入协作者C</p><ul><li>C向A,B分发公匙</li><li>A,B利用公匙加密梯度计算结果</li><li>A,B分别利用加密信息进行计算，并汇总给C <strong>？？A,B怎么使用加密信息</strong></li><li>C解密汇总信息，分别传回给A,B，A,B各种更新模型</li></ul></li><li><p>效果激励：区块链记录，提供数据多的机构其模型的效果也更好 <strong>？？不是平等吗，奖励贡献数据多的机构，体现在哪</strong></p><blockquote><p>提供的数据多的机构会看到模型的效果也更好，这体现在对自己机构的贡献和对他人的贡献。这些模型对他人效果在联邦机制上以分给各个机构反馈，并继续激励更多机构加入这一数据联邦</p></blockquote></li></ol><h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><p>与差分隐私理论比较：联邦学习传输中间计算参数数据，而差分隐私等理论会传输原始数据</p><p>与分布式机器学习比较：分布式机器学习的参数服务器对各工作节点拥有完全控制权，而联邦学习各工作节点有自治权。分布式机器学习主要通过分布式调配提高计算效率和模型性能，而联邦学习主要面向数据保护。</p><p>与联邦数据库比较：联邦数据库主要用于多个异构数据库之间的管理和操作，不涉及用户数据保护及上层应用</p><h4 id="隐私保护"><a href="#隐私保护" class="headerlink" title="隐私保护"></a>隐私保护</h4><ul><li><p><a href="https://zhuanlan.zhihu.com/c_146254861" target="_blank" rel="noopener">多方安全计算 Secure Multi-party Computation(MPC)</a></p><p>参与方分别拥有各自的私有数据，在不泄露各自私有数据的情况下，分别计算关于公共函数的结果，只暴露经过加密计算的最终结果。</p><p>加密计算方法大致可分为基于噪音的方法和不基于噪音的方法</p><ul><li>基于噪音的计算方法：对输入进行干扰，对参数进行干扰，对结果进行干扰等三种类型，典型的是<strong>差分隐私</strong></li><li>不基于噪音的计算方法：通过密码学方法将数据编码或加密，然后使用加密后的数据进行计算，典型的有<strong>同态加密，混淆电路，秘密共享等</strong></li></ul></li><li><p>同态加密 Homomorphic Encryption(HE)</p><blockquote><p>将原文加密，在密文上进行运算，而不影响解密。</p></blockquote><p>基本公式：$c=b+2x+kp$ $b$为原文（0,1），$c$为密文，$x, k$为随机数，$k$为奇数密钥</p><p>$2x$为偶数噪音，$c$ 获取不了$b$的信息。$c$ mod $p$ = $b+2x$ mod $p$ ，为$2x$ 为偶数，则可根据$b+2x$ mod $p$ 的奇偶性判断$b$，完成解密。<br>$$<br>c_1=b_1+2x_1+k_1p \<br>c-2=b_2+2x_2+k_2p \<br>c_1+c_2=(b_1\oplus b_2) + 2(x_1+x_2)+(k_1+k_2)p=(b_1\oplus b_2)+2x+kp \<br>c_1 \times c_2=(b_1 \times b_2) + 2(b_1x_2+b_2x_1+2x_1x_2)+kp=(b_1 \times b_2)+2x + kp<br>$$<br>该公式具有良好的加法同态和乘法同态，只不过乘法同态时$x$会指数型增长，最终会影响解密。后续为了解决$x$的增长问题，在一定加密计算的轮次后，对$c$ 和$p$ 进行一次加密，用该次加密后的数据进行解密还原$b$，消解$x$ 的增长误差。</p></li><li><p>姚式混淆电路 Yao’s Garbled Circuit</p><blockquote><p>使用由2输入门组成的布尔电路进行运算，Alice，Bob拥有各自的私有数据</p></blockquote><ul><li>Alice随机生成密钥和标签加密电路真值表，01真值表变成了加密的随机表（加密电路），每个值对应一个标签（类字符串）</li><li>Alice将加密电路及它的加密输入对应的标签发给Bob</li><li>Bob根据自己的输入挑选一个标签对加密电路进行解密，得到相应值加密后对应的label，将其发给Alice <strong>？？这里Bob是如何保证自己选择的标签是正确的</strong></li><li>Alice根据返回的label得知结果是0还是1</li></ul></li><li><p>秘密共享 Secret Sharing</p><blockquote><p>n个参与者，每个参与者都只拿到原始数据的一部分，一个或少数几个参与者联合都无法还原出原始数据。每个参与者将自己拿到的数据进行相应的计算，结果仍然秘密共享于各方，待需要时收回。满足加法同态。</p></blockquote><p>常用(t，n)阈值秘密共享，使用多项式获得子数据项用于分发。关于乘法同态则使用随机乘积元组的方法。</p></li><li><p>差分隐私 Differential Privacy(DP)</p><blockquote><p>对于相邻数据集(数据只有细微的差别)，使用随机化算法，其输出的分布应该基本一致（得到特定输出$O$ 的概率差别不大）</p></blockquote><p>通过特定的统计分布的值对输入或者输出进行混淆，其结果应该也服从特定的统计分布。常用的有<a href="[https://zh.wikipedia.org/wiki/%E6%8B%89%E6%99%AE%E6%8B%89%E6%96%AF%E5%88%86%E5%B8%83](https://zh.wikipedia.org/wiki/拉普拉斯分布)">拉普拉斯分布</a>和<a href="[https://zh.wikipedia.org/zh/%E6%AD%A3%E6%80%81%E5%88%86%E5%B8%83](https://zh.wikipedia.org/zh/正态分布)">高斯分布</a></p></li></ul><h3 id="Firefox-amp-Berlin-amp-URL-prediction-Florian-Hartmann"><a href="#Firefox-amp-Berlin-amp-URL-prediction-Florian-Hartmann" class="headerlink" title="Firefox &amp; Berlin &amp; URL prediction  Florian Hartmann. "></a><a href="http://www.mi.fu-berlin.de/inf/groups/ag-ti/theses/download/Hartmann_F18.pdf" target="_blank" rel="noopener">Firefox &amp; Berlin &amp; URL prediction Florian Hartmann.</a></h3><p>该文章与上面WeBank的联邦学习项目关注的点不同。WeBank关注解决不同企业机构的数据联合进行学习。该文章主要关注于联合个人数据，运行于智能手机，个人电脑，物联设备的联邦学习方案。该文章作者柏林大学的教授与Firefox公司合作，使用Pytorch设计了一个预测用户URL点击的联邦分布模型，以用户的Firefox浏览器为终端用户。</p><h4 id="简易流程"><a href="#简易流程" class="headerlink" title="简易流程"></a>简易流程</h4><ol><li>服务器初始化模型</li><li>服务器分发参数给用户</li><li>用户在本地计算并将更新信息上传</li><li>服务器综合更新信息，更新模型参数。</li><li>进入下一次迭代，回到1</li></ol><h4 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h4><ul><li>超大范围，数量级的用户（设备）</li><li>用户数据的不平衡</li><li>异构数据分布</li><li>不稳定的通信条件</li><li>参数更新带来的通信压力</li></ul><h4 id="基础背景"><a href="#基础背景" class="headerlink" title="基础背景"></a>基础背景</h4><h5 id="梯度下降法"><a href="#梯度下降法" class="headerlink" title="梯度下降法"></a>梯度下降法</h5><ol><li>GD 最小化损失函数，通过梯度推导参数更新方向（变大还是变小）</li><li>SGD 当数据量大，参数多时，计算全局梯度太过耗费计算资源。通过计算数据集中部分数据的梯度同样可以正确推导更新方向</li><li>mini-batch GD 每次都随机选择数据进行梯度计算，存在方差问题，即使用部分数据，而忽略了其他数据的信息。通过将训练集分为多个子集，同时使用GPU的并行计算能力，每次选择几个子集并行计算梯度。</li></ol><h5 id="计算图"><a href="#计算图" class="headerlink" title="计算图"></a><a href="https://mrliao.cn/2017/07/31/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E7%AE%97%E6%B3%95%EF%BC%9A%E4%BD%BF%E7%94%A8%E5%9B%BE%E8%AE%A1%E7%AE%97%E6%B1%82%E5%BE%AE%E5%88%86/" target="_blank" rel="noopener">计算图</a></h5><p><img src="../images/compute_graph.jpg" alt="compute_graph"></p><p>将计算公式的变量，常量，计算操作使用一个个点表示，组合为一个有向图。</p><ul><li>对于同一变量，同公式，只占用一个点</li><li>图节点可以保存中间计算结果</li><li>由于保存有中间结果，链式运算更便捷</li><li>反向计算更有优势，可以一次计算出所有的偏导值</li></ul><h5 id="联合优化"><a href="#联合优化" class="headerlink" title="联合优化"></a>联合优化</h5><ol><li>偏差优化</li></ol><p>联邦学习的隐私机制要求，更多的计算其实放在用户节点，实际意义上的<strong>分布式训练</strong>。服务器端为了更有效的估计更新值，<strong>每次迭代只使用部分用户的特征数据</strong>，以$n_i / n$ 的采样概率筛选用户，可以证明用户训练数据的分布对估计量<strong>对偏差没有影响</strong>，但由于各用户的独立性和分布式训练导致很难确保参与训练的用户特征数据具有相似的估计分布，会<strong>导致较大的方差</strong>。</p><p><img src="../images/bias1.jpg" alt="bias1"></p><p><img src="../images/bias2.jpg" alt="bias2"></p><ol start="2"><li>方差优化</li></ol><p>针对存在的方差问题，可以通过一些采样技术减小方差。常用的有分层抽样和聚类抽样。</p><ul><li>分层抽样：将所有样本用户按用户特征划分阶层，训练时按一定比例从各层随机抽取样本</li><li>聚类抽样：将所有样本用户归并成若干个互不交叉，互不重复的群，各群内差异大，群间差异小。训练时以群为抽样单位抽取样本。</li></ul><ol start="3"><li><p>流式训练</p><p>将参与训练的用户看作数据流，在数据流上进行训练，新加入的数据仅使用一次即丢弃，即时通过下一刻的输入进行验证。每一个新数据都是上一次的验证集，也参与下一次的更新。</p></li><li><p>RProp</p><p>对于联邦学习模型，其不收集任何数据，在部署之前，是没有数据可供训练的，也就没有相关的梯度信息，梯度大小在训练过程中可能会有较大的波动。 RProp作为一种动态适应学习速率的梯度下降法，它仅使用梯度分量的符号，忽略梯度的幅度。</p><p><img src="../images/RProp.jpg" alt=""></p><p><img src="../images/lr.jpg" alt=""></p><p>在RProp的迭代中，通过比较当前和上一次迭代的偏导数的符号确定学习率。其中$\alpha &gt; 1 &gt; \beta$ 缩放步长，具体取决于偏导数的符号，然后使用$\eta_\max$和$\eta_\min$ 限制步长，以免步长变得太大或太小。</p><p>因此各用户将梯度的更新信息传递到服务器，服务器通过平均梯度值再通过上面的公式更新学习率和权重。但RProp对随机噪声高度敏感，若参与用户太少，则可能导致更高的方差。</p></li></ol><h4 id="通信"><a href="#通信" class="headerlink" title="通信"></a>通信</h4><p>对于联邦学习，由于将训练过程分散到了各个终端，用户只有较少的训练数据，不太占用太多的计算资源，反而由于终端通信的问题，参数传递成为了一个比较重要的问题。这就需要对待传递的参数进行一定程度的压缩，减少所需带宽。</p><p>常用的方法是使用<strong>稀疏蒙版</strong>强制进行稀疏更新，即仅允许每个用户更新一定数量的权重值。每个客户的使用不同的随机种子，以概率p从伯努利分布中采样与权重矩阵w相同大小的随机掩码矩阵M<br>$$<br>M_{ij} \sim Bernoulli(p) \<br>p=\frac {\log m} m \<br>\bar H=(H\bullet M) \times \frac 1 x \<br>(A \bullet B)<em>{ij}=A</em>{ij}\bullet B_{ij}<br>$$<br>客户端将随机种子给服务器，服务器根据种子重建掩码矩阵，确定每个用户的参数更新矩阵，用户的每次更新，只更新部分参数</p><p>进一步的，对于参数矩阵$H$ 概率量化，可以有效减少传输所需带宽。即将常规的浮点数参数转化为0，1二值，原本一个浮点数需要4字节的空间，而二值只需要1位bit，大大减少了空间需求。当然，这一措施只能针对大多用户具有相似的分布时才能生效。</p><h4 id="隐私保护-1"><a href="#隐私保护-1" class="headerlink" title="隐私保护"></a>隐私保护</h4><p>在上一篇笔记中也大致说了现在常用的几个隐私保护技术，在这篇文章中，作者使用的就是差分隐私。<br>$$<br>P[Q(D_1) \in R] \le e^\epsilon * P[Q(D_2) \in R] + \delta<br>$$<br>对相邻数据集$D_1,D_2$ ,执行统计查询Q，他们的结果具有相同的统计分布，差距小于$e^\epsilon$，其中$\epsilon$ 是超参数（差分级别）。即向任一数据集额外添加一点数据不能改变查询结果。同时为了避免恶意用户通过多用户估计的方式估计其他用户数据，额外添加了随机噪声$\delta$ 。<br>$$<br>\sigma \le c_2 \frac {q\sqrt {T\log {\frac 1 \delta}}} {\epsilon}<br>$$<br>在这个基础上，实现了基于SGD的学习算法，在每T次迭代中计算梯度估计值，使用概率q对用户进行采样，每次迭代时将从$N(0,\sigma^2)$采样的噪声添加到估计值，计算下一次权重时减去该估计值。</p><h4 id="个性化"><a href="#个性化" class="headerlink" title="个性化"></a>个性化</h4><p>对于新加入的用户，由于其之前没有数据，没有参与训练，为了将其加入训练网络并针对性的优化模型，通常使用迁移学习的方法完成这一步。</p><ol><li>使用联邦学习，所有用户共同训练一个中心模型</li><li>使用迁移学习的技术，各用户在本地构建个性化向量微调其模型。</li><li>当有新用户加入时，直接使用中心模型，后续迭代过程中，构建自己的个性化向量微调模型。</li></ol><p>各用户的个性化向量本地保持，不与服务器交互。在一定的初始用户共同完成中心模型的训练，达到一定的质量后，模型优化和个性化向量的优化交替执行。每2次迭代，使用计算个性化损失的偏导数并进行更新，随着不断迭代，该向量将紧密反映用户的偏好。在对模型参数进行更新时，将个性化向量作为附加输入优化模型权重。</p><h3 id="Google-AI-amp-Gborad-amp-Next-word-prediction"><a href="#Google-AI-amp-Gborad-amp-Next-word-prediction" class="headerlink" title="Google AI &amp; Gborad &amp; Next-word prediction"></a><a href="https://arxiv.org/abs/1902.01046" target="_blank" rel="noopener">Google AI &amp; Gborad &amp; Next-word prediction</a></h3><p>Google的这篇关于联邦学习的文章主要也是面向用户toC的。他们使用Tensorflow构建联邦学习框架，使用Android平台的移动手机用户为训练终端，设计关于Gboard的单词预测任务。</p><h4 id="简易流程-1"><a href="#简易流程-1" class="headerlink" title="简易流程"></a>简易流程</h4><p>在他们设计架构中，分为终端设备和服务器两个部分，终端设备训练基于本地数据进行训练，服务器集中更新模型参数，通过一些通信策略和安全策略保证分布式的通信问题和数据安全。</p><ol><li>服务器挑选并通知合适的设备参与模型训练，等待设备的确定</li><li>服务器检查服务器持久化存储的模型</li><li>服务器将模型参数和配置以及训练任务分发给设备</li><li>设备基于本地数据进行训练，并将更新参数返回</li><li>服务器聚合收到的更新数据并更新到模型</li><li>存储更新后的基础模型</li></ol><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><h5 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h5><p>对于单词预测任务，他们选用了基于长短期记忆(LSTM)的递归神经网络(RNN)模型（输入耦合忘记门CIFG）。实验组使用了大概150万用户训练了6亿句话进行训练，对照组在服务器环境下使用服务器日志信息，大约75亿个句子进行训练。</p><p><img src="/Users/pipiper/Project/blog/source/images/Gborad_result.jpg" alt=""></p><p>最后结果显示实验组和对照组的准确率差不多，0.1%的差别。但联邦模型对数据安全方面更有利。</p><h5 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h5><p>全局模型首先在服务器上生成随机初始化或由一些可用的代理数据进行预训练。根据数据安全的限制及可以证明的更新有效性，每轮选择100个左右的设备参与训练，考虑设备可能存在的一些断联和不符合条件的情况，预选阶段会预选130%的设备数。获取来自客户端的更新参数后，每个设备的返回值以一定的权重参与本次权重更新（在本次单词预测任务中，以用户输入的单词量$n_k$作为参考）。<br>$$<br>w_{t+1}=\sum_{k=1}^K {\frac {n_k}{N} w_{t+1}^k}<br>$$<br>使用<strong>Federated Averaging算法</strong>来组合客户端更新生成新的全局模型。</p><p><img src="../images/FederatedAveraging.jpg" alt=""></p><p>由于用户端设备的不确定性和数据安全协议，需要服务器对参与训练的设备及任务的分配进行一定的配置，即实现动态资源管理和负载均衡策略。</p><p>该模型中选择使用多方聚合保证数据安全，即当收集到足够数量的用户更新数据，才能对数据进行解密。该协议流程分为四轮，前两轮为准备阶段，属于设备的数据预处理阶段，</p><h5 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h5><p>由于训练过程需要大量的计算资源和内存资源，且极为耗电。因此对训练设备的性能有一定要求：有至少2G内存，空闲状状态，充电并且处于Wi-Fi网络下。这也从侧面限制同一时间内参与训练的设备数量会较少，但同时也更易于进行同步控制。</p><p>同样由于客户端设备的限制，要求任务模型不能太大，在一定程度上限制了模型的性能，要求更好的压缩技术。Google团队最终交付给GBorad设备的模型大小为1.4M。</p><p>客户端设备在训练时，根据当前模型$w_t$，使用随机梯度下降法(SGD)进行训练平均梯度$g_k$，学习率$\epsilon$固定。本地客户端更新值$w_{t+1}^k$:<br>$$<br>w_{t+1}^t=w_t-\epsilon g_k<br>$$<br>每个轮次完成后，即时销毁临时数据，及时释放不必要的内存占用。</p></div><div class="post-share">分享到：</div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/sss-hot-update/" rel="next" title="SSR热更新方案"><i class="fa fa-chevron-left"></i> SSR热更新方案</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/keep-smile/" rel="prev" title="保持微笑">保持微笑 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="disqus_thread"><div id="dsqjs"><section class="dsqjs-info"><p id="dsqjs-load-disqus" class="dsqjs-message">评论完整模式加载中...如果长时间无法加载，请针对 disq.us | disquscdn.com | disqus.com 启用代理</p></section></div></div></div><script type="text/javascript">window.DISQUS=null,new DisqusJS({shortname:"pipiper",siteName:"Pipiper coming !",identifier:"federatedLearning/",url:"http://blog.lizardlove.ren/federatedLearning/",api:"",apikey:"",admin:"pipiper",adminLabel:"废话"})</script></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">Overview</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/card.jpg" alt="Pipiper"><p class="site-author-name" itemprop="name">Pipiper</p><p class="site-description motion-element" itemprop="description">多吃多骗</p></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/lizardlove" target="_blank" title="GitHub" data-balloon="GitHub" data-balloon-pos="up"><i class="fa fa-fw fa-github"></i></a> </span><span class="links-of-author-item"><a href="https://twitter.com/xiyiailoli" target="_blank" title="Twitter" data-balloon="Twitter" data-balloon-pos="up"><i class="fa fa-fw fa-twitter"></i></a> </span><span class="links-of-author-item"><a href="mailto:xiyiailoli@gmail.com" target="_blank" title="Gmail" data-balloon="Gmail" data-balloon-pos="up"><i class="fa fa-fw fa-envelope"></i></a> </span><span class="links-of-author-item"><a href="https://t.me/PipiperZhang" target="_blank" title="Telegram 频道" data-balloon="Telegram 频道" data-balloon-pos="up"><i class="fa fa-fw fa-telegram"></i></a></span></div><details class="views-top-wrap"><summary class="views-top-name">看爆 Top10</summary><ul class="views-top"></ul></details><div class="feed-link motion-element"><a class="feed-rss" href="/atom.xml" rel="alternate" target="_blank"><i class="fa fa-rss"></i> <span>RSS 订阅</span></a></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">14</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><span class="site-state-item-count">6</span> <span class="site-state-item-name">categories</span></div></nav><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" target="_blank"><img src="/images/cc-by-nc-sa.png" alt="Creative Commons"></a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#WeBank联邦学习应用与研究"><span class="nav-number">1.</span> <span class="nav-text">WeBank联邦学习应用与研究</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#原因："><span class="nav-number">1.1.</span> <span class="nav-text">原因：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#概述："><span class="nav-number">1.2.</span> <span class="nav-text">概述：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#分类"><span class="nav-number">1.3.</span> <span class="nav-text">分类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#流程"><span class="nav-number">1.4.</span> <span class="nav-text">流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#区别"><span class="nav-number">1.5.</span> <span class="nav-text">区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#隐私保护"><span class="nav-number">1.6.</span> <span class="nav-text">隐私保护</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Firefox-amp-Berlin-amp-URL-prediction-Florian-Hartmann"><span class="nav-number">2.</span> <span class="nav-text">Firefox &amp; Berlin &amp; URL prediction Florian Hartmann.</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#简易流程"><span class="nav-number">2.1.</span> <span class="nav-text">简易流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#难点"><span class="nav-number">2.2.</span> <span class="nav-text">难点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#基础背景"><span class="nav-number">2.3.</span> <span class="nav-text">基础背景</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#梯度下降法"><span class="nav-number">2.3.1.</span> <span class="nav-text">梯度下降法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#计算图"><span class="nav-number">2.3.2.</span> <span class="nav-text">计算图</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#联合优化"><span class="nav-number">2.3.3.</span> <span class="nav-text">联合优化</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#通信"><span class="nav-number">2.4.</span> <span class="nav-text">通信</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#隐私保护-1"><span class="nav-number">2.5.</span> <span class="nav-text">隐私保护</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#个性化"><span class="nav-number">2.6.</span> <span class="nav-text">个性化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Google-AI-amp-Gborad-amp-Next-word-prediction"><span class="nav-number">3.</span> <span class="nav-text">Google AI &amp; Gborad &amp; Next-word prediction</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#简易流程-1"><span class="nav-number">3.1.</span> <span class="nav-text">简易流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置"><span class="nav-number">3.2.</span> <span class="nav-text">配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#模型"><span class="nav-number">3.2.1.</span> <span class="nav-text">模型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务器"><span class="nav-number">3.2.2.</span> <span class="nav-text">服务器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#客户端"><span class="nav-number">3.2.3.</span> <span class="nav-text">客户端</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-image"></div><div class="footer-inner"><p>博客已萌萌哒运行<span id="since"></span><span class="my-face">(●'◡'●)ﾉ♥</span></p><p>托管于<a href="https://github.com/" target="_blank" rel="nofollow"> GitHub</a>. <a href="http://www.google.com/analytics/" target="_blank" rel="nofollow">Google Analytics </a>提供网站统计服务.</p><p>© <span itemprop="copyrightYear">2020</span> Pipiper coming !. 由 <a href="https://hexo.io/" target="_blank" class="external" rel="nofollow">Hexo</a> 强力驱动. Theme By <a href="https://github.com/DIYgod/hexo-theme-sagiri" target="_blank" class="external" rel="nofollow">Sagiri</a> v0.0.53. <a href="/sitemap.xml" target="_blank">站点地图</a>. .</p><p>Made with <i class="fa fa-heart throb" style="color:#d43f57"></i> by <span class="author" itemprop="copyrightHolder">Pipiper</span>.</p></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div><canvas id="evanyou"></canvas><div id="aplayer-fixed"></div></div><script type="text/javascript" src="/js/sagiri.min.js?v=0.0.53"></script><script>var serviceWorkerUri="/sw.js";"serviceWorker"in navigator?navigator.serviceWorker.register(serviceWorkerUri).then(function(){navigator.serviceWorker.controller?console.log("Assets cached by the controlling service worker."):console.log("Please reload this page to allow the service worker to handle network operations.")}).catch(function(e){console.log("ERROR: "+e)}):console.log("Service workers are not supported in the current browser.")</script></body></html>